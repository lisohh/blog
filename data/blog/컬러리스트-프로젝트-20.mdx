---
title: '🎉 컬러리스트 프로젝트 #20 백엔드 연결해서 회원가입, 로그인하기'
thumbSrc: '/static/images/colorlist.png'
date: '2022-11-10'
tags: ['project', 'colorlist', '회원가입', '로그인']
draft: false
summary: '본 포스트는 컬러리스트 연습을 위한 사이트를 만들며 작성한 글입니다.'
images: ['/static/images/colorlist.png']
---

# 📌

![Welcome](/static/images/colorlist.png)

> ✨ [컬러리스트 사이트(아직 없음](https://www.)

오늘은 백엔드와 프론트엔드 서버를 동시에 열어놓고<br/>
로그인과 회원가입을 성공한 경우<br/>
페이지 이동 및 전달된 토큰 내용을 `alert`로 확인할 수 있게 해보았다.

### api 연결 전 Register.tsx

전에 만들어둔 `Register.tsx`에 들어가보면<br/>
아직 백엔드와 연결하는 코드가 없고 `data`를 `alert`창에서 보여주게끔 만들어 놓았다.

```tsx
onSubmit={handleSubmit((data) => {
        alert(JSON.stringify(data));
```

### fetch 함수 사용

이제 우리는 회원가입을 완료한 경우,<br/>
`api`에 있는 `join`함수를 통해 `data`를 전달받아 `response`에 둘 것이다.<br/>

<br />
그러기 위해 우리는 `fetch`와 `post`를 사용할 것인데
<br />
<br />
`fetch()`는 `React`의 함수로 `API`를 사용하여 백엔드 서버와 비동기 요청을 하는 방식 중 하나이다.
<br />
`post`는 `method`중 하나로 `data`를 보내기 위한 방법이다.

그런데 이번엔 `fetch`함수를 좀 더 편하게 쓰기 위해<br/>
`post`함수로 한번 감싸서(캡슐화) `method`와 `header`, `body`를 미리 정하고 사용한다.<br/>
이렇게 사용하면 1. 사용하기가 쉽고 2. 나중에 교체하기가 간편하며 3. 실수를 방지하기 좋다.

```tsx
function post<T>(path: string, data: T) {
  return fetch(HOST + path, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
    },
    body: JSON.stringify(data),
  })
}
```

이렇게 `post`함수를 만들어놓으면 그 다음에 `join,login,saveColors` 등 여러 함수에는<br/>
`path`와 보낼 `data`만 넣으면 돼서 코드를 보기가 편해진다.

```tsx
// 회원가입
export function join(data: UserInfoT) {
  return post('/auth/join', data)
}

// login
export function login(data: UserInfoT) {
  return post('/auth/login', data)
}
```

위에 만들어놓은 `post`함수를 이용해 회원가입과 로그인에 필요한 함수를 작성했다.<br/>
`path`는 백엔드 서버를 킨 후 터미널에 뜨는 `path`를 보고 작성했는데,<br/>
백엔드에서 `api schema`를 작성해서 `type과 client generation`을 해주면 좋다고 한다.<br/>
하지만 지금은 `path`가 그리 많지 않아서 터미널에서 보고 작성하는데 별 문제 없었다.

두 함수에서 넘겨주는 `data`의 타입은 `global.d.ts`에서 정의했는데,
지금은 간단히 이메일과 비밀번호만 정의해주었다.

```tsx
type UserInfoT = {
  email: string
  password: string
}
```

### api import

다시 `Register.tsx`로 돌아와서
아까 만들어놓은 `join`함수를 이제 `import`해주어야 한다.

```tsx
import * as api from '../../api'
```

여기서 `* as api`라고 쓰는 이유는 해당 파일안에는 여러 함수가 있는데,
하나만 쓸거면 해당 함수 이름을 `{}`안에 넣고 가져오면 되지만
모두 가져오면 이것저것 쓰기가 훨씬 편해지므로 모두 가져오기로 했다.

```tsx
onSubmit={handleSubmit(async (data) => {
        const response = await api.join(data);
```

### 회원가입 성공시 페이지 이동하기

그리고 `response`의 반응이 200번대나 300번대, 즉 성공 범위 안에 있을 경우<br/>
`ok`로 성공을 간주하고, `react-router-dom`에 있는 `useNavigate()`를 이용해 로그인 페이지로 이동한다.

> **ok**<br>
> ok는 status의 200-299의 값을 추상화한 boolean인데 200-299사이의 status이면 true를 가지게 된다.<br>
> 출처: https://velog.io/@daybreak/React-Fetch%ED%95%A8%EC%88%98

```tsx
import { Link, useNavigate } from "react-router-dom";
  ...

function Register() {
  const navigate = useNavigate();
  ...

if (response.ok) {
          navigate("/login");
        }
```

### 로그인 Login.tsx도 동일하게

`Login.tsx`도 일단 동일하게 로그인에 성공했을 경우만 코드로 작성했다.<br/>
조금 다르게 한 것은 로그인에 성공했을 경우 전달된 `jwt`토큰 값을 `result`에 넣고<br/>
`alert`창에 띄워 볼 수 있게 했다.

```tsx
onSubmit={handleSubmit(async (data) => {
        const response = await api.login(data);

        if (response.ok) {
          const result = await response.json(); // body로 온 json을 파싱함!

          alert(JSON.stringify(result));
          navigate("/");
        }
      })}
```

이렇게 해서 현재 회원가입과 로그인에 성공했을 경우를 간단히 작동시킬 수 있게 되었다.<br/>
중간에 `input` 타입에 에러가 나서 `forwardRef`로 수정을 했는데 이 부분에 대해서는 나중에 정리해보겠다.
